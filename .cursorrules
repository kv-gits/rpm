# RPM - Rust Password Manager
# Конвенции и правила для разработки

## Общая архитектура

### Структура проекта
- `src/main.rs` - точка входа приложения
- `src/tui/` - модуль терминального интерфейса
- `src/tray/` - модуль системного трея
- `src/server/` - HTTP сервер для расширений браузера
- `src/crypto/` - модуль криптографии и шифрования
- `src/db/` - модуль работы с базой данных
- `src/config/` - модуль конфигурации
- `src/models/` - модели данных
- `src/errors/` - типы ошибок

## Конвенции кода

### Rust стиль
- Используем `rustfmt` для форматирования
- Используем `clippy` для линтинга
- Следуем Rust API Guidelines
- Документируем публичные API с помощью `///`

### Обработка ошибок
- Используем `thiserror` для определения типов ошибок
- Используем `anyhow::Result` для контекста ошибок
- Всегда обрабатываем ошибки явно, не используем `unwrap()` в production коде
- Используем `?` оператор для распространения ошибок

### Безопасность
- **КРИТИЧНО**: Никогда не логируем пароли, ключи шифрования или чувствительные данные
- Все пароли хранятся только в зашифрованном виде
- Используем secure memory для хранения ключей в памяти
- Очищаем память после использования чувствительных данных
- Используем константное время сравнения для паролей и ключей

### Криптография
- Используем AES-256-GCM для симметричного шифрования
- Используем Argon2id для хеширования мастер-паролей
- Используем ChaCha20Poly1305 как альтернативу AES
- Используем Ed25519 для цифровых подписей
- Используем X25519 для обмена ключами
- Всегда используем аутентифицированное шифрование
- Генерируем криптографически стойкие случайные числа через `rand::CryptoRng`

### Асинхронность
- Используем `tokio` как async runtime
- Все I/O операции должны быть асинхронными
- Используем `tokio::spawn` для параллельных задач
- Используем каналы для коммуникации между компонентами

### TUI
- Используем `ratatui` для построения интерфейса
- Используем `crossterm` для работы с терминалом
- Обрабатываем все события клавиатуры
- Поддерживаем vi-подобные навигационные клавиши
- Обеспечиваем плавное обновление интерфейса

### Системный трей
- Трей должен быть доступен на всех платформах (Linux, Windows, macOS)
- Используем нативные API для каждой платформы
- Меню трея должно позволять быстрое управление приложением

### HTTP сервер
- Используем `axum` для построения API
- Все эндпоинты должны требовать аутентификацию
- Используем токены для авторизации расширений
- Валидируем все входные данные
- Используем CORS только для разрешенных доменов расширений

### База данных
- Используем SQLite для локального хранения
- Все данные в БД должны быть зашифрованы
- Используем транзакции для атомарных операций
- Регулярно делаем резервные копии

### Тестирование
- Пишем unit тесты для всех модулей
- Пишем integration тесты для критических путей
- Используем mock объекты для тестирования криптографии
- НЕ тестируем с реальными паролями в CI/CD

## Структура коммитов

Используем conventional commits:
- `feat:` - новая функциональность
- `fix:` - исправление багов
- `docs:` - изменения в документации
- `refactor:` - рефакторинг кода
- `test:` - добавление тестов
- `chore:` - обновление зависимостей, конфигурации
- `security:` - исправления безопасности
- `crypto:` - изменения в криптографии

## Приоритеты разработки

1. **Безопасность** - всегда на первом месте
2. **Производительность** - особенно для криптографических операций
3. **Удобство использования** - интуитивный интерфейс
4. **Надежность** - обработка всех edge cases

## Запрещенные практики

- ❌ Хранение паролей в plaintext
- ❌ Использование слабых алгоритмов шифрования (MD5, SHA1, DES)
- ❌ Логирование чувствительных данных
- ❌ Использование `unsafe` без крайней необходимости
- ❌ Игнорирование предупреждений компилятора
- ❌ Использование `unwrap()` в production коде

## Рекомендуемые практики

- ✅ Использование типов для обеспечения безопасности (например, `EncryptedPassword`)
- ✅ Валидация всех входных данных
- ✅ Использование `zeroize` для очистки памяти
- ✅ Регулярный аудит безопасности кода
- ✅ Использование статического анализа (`cargo audit`)
- ✅ Документирование всех публичных API

